<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Track your body composition metrics over time">
    <meta name="theme-color" content="#3b82f6">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Body Tracker">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <title>Body Composition Tracker</title>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>üìä Body Tracker</h1>
            <button id="menuBtn" class="menu-btn" aria-label="Menu">‚ãÆ</button>
        </header>

        <!-- Menu Overlay -->
        <div id="menuOverlay" class="menu-overlay">
            <div class="menu-content">
                <button class="menu-close" id="menuClose">&times;</button>
                <h2>Menu</h2>
                <button class="menu-item" id="exportBtn">üì§ Export Data</button>
                <button class="menu-item" id="importBtn">üì• Import Data</button>
                <button class="menu-item" id="clearBtn">üóëÔ∏è Clear All Data</button>
                <button class="menu-item" id="aboutBtn">‚ÑπÔ∏è About</button>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Quick Add Button -->
            <div class="quick-add-section">
                <button id="addDataBtn" class="btn btn-primary btn-large">
                    ‚ûï Add Measurement
                </button>
            </div>

            <!-- Metric Selector -->
            <div class="metric-selector-section">
                <label for="metricSelect">View Metric:</label>
                <select id="metricSelect" class="form-control">
                    <option value="">-- Select a metric --</option>
                </select>
            </div>

            <!-- Date Filter -->
            <div class="date-filter-section">
                <div class="date-inputs">
                    <div class="date-input-group">
                        <label for="startDate">From:</label>
                        <input type="date" id="startDate" class="form-control">
                    </div>
                    <div class="date-input-group">
                        <label for="endDate">To:</label>
                        <input type="date" id="endDate" class="form-control">
                    </div>
                </div>
                <div class="filter-buttons">
                    <button id="applyFilterBtn" class="btn btn-secondary">Apply</button>
                    <button id="clearFilterBtn" class="btn btn-secondary">Clear</button>
                </div>
            </div>

            <!-- Chart Section -->
            <div class="chart-section">
                <div id="noDataMessage" class="no-data-message">
                    <p>üìà Select a metric to view your progress</p>
                </div>
                <canvas id="metricChart"></canvas>
            </div>

            <!-- Stats Section -->
            <div class="stats-section" id="statsSection">
                <div class="stat-card">
                    <h3>Latest</h3>
                    <p id="latestValue" class="stat-value">--</p>
                </div>
                <div class="stat-card">
                    <h3>Average</h3>
                    <p id="averageValue" class="stat-value">--</p>
                </div>
                <div class="stat-card">
                    <h3>Change</h3>
                    <p id="changeValue" class="stat-value">--</p>
                </div>
                <div class="stat-card">
                    <h3>Entries</h3>
                    <p id="dataPoints" class="stat-value">--</p>
                </div>
            </div>

            <!-- Recent Measurements -->
            <div class="recent-section">
                <h2>Recent Measurements</h2>
                <div id="recentList" class="recent-list">
                    <p class="no-data">No measurements yet. Add your first one!</p>
                </div>
            </div>
        </main>

        <!-- Add/Edit Modal -->
        <div id="measurementModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">Add Measurement</h2>
                    <button class="modal-close" id="modalClose">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="measurementForm">
                        <input type="hidden" id="measurementId">
                        
                        <div class="form-group">
                            <label for="measurementDate">Date *</label>
                            <input type="date" id="measurementDate" class="form-control" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="weight">Weight (kg)</label>
                                <input type="number" id="weight" class="form-control" step="0.1" min="0" inputmode="decimal">
                            </div>
                            <div class="form-group">
                                <label for="fatPercentage">Fat %</label>
                                <input type="number" id="fatPercentage" class="form-control" step="0.1" min="0" max="100" inputmode="decimal">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="fatMass">Fat Mass (kg)</label>
                                <input type="number" id="fatMass" class="form-control" step="0.1" min="0" inputmode="decimal">
                            </div>
                            <div class="form-group">
                                <label for="ffm">
                                    FFM (kg)
                                    <span class="tooltip-icon" title="Fat-Free Mass: Total body weight minus fat mass">‚ìò</span>
                                </label>
                                <input type="number" id="ffm" class="form-control" step="0.1" min="0" inputmode="decimal">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="muscleMass">Muscle Mass (kg)</label>
                                <input type="number" id="muscleMass" class="form-control" step="0.1" min="0" inputmode="decimal">
                            </div>
                            <div class="form-group">
                                <label for="tbwKg">
                                    TBW (kg)
                                    <span class="tooltip-icon" title="Total Body Water in kilograms">‚ìò</span>
                                </label>
                                <input type="number" id="tbwKg" class="form-control" step="0.1" min="0" inputmode="decimal">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="tbwPercentage">
                                    TBW %
                                    <span class="tooltip-icon" title="Total Body Water percentage">‚ìò</span>
                                </label>
                                <input type="number" id="tbwPercentage" class="form-control" step="0.1" min="0" max="100" inputmode="decimal">
                            </div>
                            <div class="form-group">
                                <label for="boneMass">Bone Mass (kg)</label>
                                <input type="number" id="boneMass" class="form-control" step="0.1" min="0" inputmode="decimal">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="bmrKj">
                                    BMR (kJ)
                                    <span class="tooltip-icon" title="Basal Metabolic Rate in kilojoules">‚ìò</span>
                                </label>
                                <input type="number" id="bmrKj" class="form-control" step="1" min="0" inputmode="numeric">
                            </div>
                            <div class="form-group">
                                <label for="bmrKcal">
                                    BMR (kcal)
                                    <span class="tooltip-icon" title="Basal Metabolic Rate in kilocalories">‚ìò</span>
                                </label>
                                <input type="number" id="bmrKcal" class="form-control" step="1" min="0" inputmode="numeric">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="metabolicAge">Metabolic Age</label>
                                <input type="number" id="metabolicAge" class="form-control" step="1" min="0" inputmode="numeric">
                            </div>
                            <div class="form-group">
                                <label for="visceralFatRating">Visceral Fat</label>
                                <input type="number" id="visceralFatRating" class="form-control" step="0.1" min="0" inputmode="decimal">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="bmi">
                                BMI
                                <span class="tooltip-icon" title="Body Mass Index">‚ìò</span>
                            </label>
                            <input type="number" id="bmi" class="form-control" step="0.1" min="0" inputmode="decimal">
                        </div>

                        <div class="form-group">
                            <label for="notes">Notes</label>
                            <textarea id="notes" class="form-control" rows="2"></textarea>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-block">Save</button>
                            <button type="button" class="btn btn-secondary btn-block" id="cancelBtn">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="toast"></div>

        <!-- Hidden file input for import -->
        <input type="file" id="fileInput" accept=".json" style="display: none;">
    </div>

    <!-- Scripts -->
    <script src="app.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed'));
        }
    </script>
</body>
</html>